{"config":{"lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Agrotools API REST Esta API REST atua como um gateway obtendo dados da API Agrotools , persistindo e retornando ao usu\u00e1rio. Desenvolvido por Auctus.ai - Intelig\u00eancia Aumentada . Comandos No SO Linux , ap\u00f3s iniciar o ambiente virtual python 3.7.9 \u00e9 poss\u00edvel executar os comandos abaixo: make install - Instala o projeto. make init_db - Inicializa o banco de dados. make test - Executa a cobertura de testes. make run - Iniciliza a API (servidor). Organiza\u00e7\u00e3o das pastas . \u251c\u2500\u2500 app \u2502 \u251c\u2500\u2500 app.db \u2502 \u251c\u2500\u2500 auth_decorator.py \u2502 \u251c\u2500\u2500 config.py \u2502 \u251c\u2500\u2500 controller \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 conect_analy_terrir.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 data.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 log.py \u2502 \u251c\u2500\u2500 models \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u251c\u2500\u2500 models.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 request.py \u2502 \u251c\u2500\u2500 resources \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 auth.py \u2502 \u2502 \u251c\u2500\u2500 contacts.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 schemas \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u2514\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 service \u2502 \u251c\u2500\u2500 client \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 auth.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 db \u2502 \u2502 \u251c\u2500\u2500 analysis_db.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw_db.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories_db.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 tidy_data.py \u251c\u2500\u2500 main.py \u251c\u2500\u2500 Makefile \u251c\u2500\u2500 manage.py \u251c\u2500\u2500 README.md \u251c\u2500\u2500 requirements-dev.txt \u251c\u2500\u2500 requirements.txt \u251c\u2500\u2500 setup.py \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 conftest.py \u2502 \u251c\u2500\u2500 test_00.py \u2502 \u251c\u2500\u2500 test_01_client_agrot.py \u2502 \u2514\u2500\u2500 test_02_api.py \u2514\u2500\u2500 token_client.json 22 directories, 146 files","title":"Home"},{"location":"#agrotools-api-rest","text":"Esta API REST atua como um gateway obtendo dados da API Agrotools , persistindo e retornando ao usu\u00e1rio. Desenvolvido por Auctus.ai - Intelig\u00eancia Aumentada .","title":"Agrotools API REST"},{"location":"#comandos","text":"No SO Linux , ap\u00f3s iniciar o ambiente virtual python 3.7.9 \u00e9 poss\u00edvel executar os comandos abaixo: make install - Instala o projeto. make init_db - Inicializa o banco de dados. make test - Executa a cobertura de testes. make run - Iniciliza a API (servidor).","title":"Comandos"},{"location":"#organizacao-das-pastas","text":". \u251c\u2500\u2500 app \u2502 \u251c\u2500\u2500 app.db \u2502 \u251c\u2500\u2500 auth_decorator.py \u2502 \u251c\u2500\u2500 config.py \u2502 \u251c\u2500\u2500 controller \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 conect_analy_terrir.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 data.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u251c\u2500\u2500 log.py \u2502 \u251c\u2500\u2500 models \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u251c\u2500\u2500 models.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 request.py \u2502 \u251c\u2500\u2500 resources \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 auth.py \u2502 \u2502 \u251c\u2500\u2500 contacts.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 schemas \u2502 \u2502 \u251c\u2500\u2500 full_data_raw.py \u2502 \u2502 \u2514\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 service \u2502 \u251c\u2500\u2500 client \u2502 \u2502 \u251c\u2500\u2500 analysis.py \u2502 \u2502 \u251c\u2500\u2500 auth.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories.py \u2502 \u251c\u2500\u2500 db \u2502 \u2502 \u251c\u2500\u2500 analysis_db.py \u2502 \u2502 \u251c\u2500\u2500 full_data_raw_db.py \u2502 \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2502 \u2514\u2500\u2500 territories_db.py \u2502 \u251c\u2500\u2500 __init__.py \u2502 \u2514\u2500\u2500 tidy_data.py \u251c\u2500\u2500 main.py \u251c\u2500\u2500 Makefile \u251c\u2500\u2500 manage.py \u251c\u2500\u2500 README.md \u251c\u2500\u2500 requirements-dev.txt \u251c\u2500\u2500 requirements.txt \u251c\u2500\u2500 setup.py \u251c\u2500\u2500 tests \u2502 \u251c\u2500\u2500 conftest.py \u2502 \u251c\u2500\u2500 test_00.py \u2502 \u251c\u2500\u2500 test_01_client_agrot.py \u2502 \u2514\u2500\u2500 test_02_api.py \u2514\u2500\u2500 token_client.json 22 directories, 146 files","title":"Organiza\u00e7\u00e3o das pastas"},{"location":"auth/","text":"Autentica\u00e7\u00e3o A autentica\u00e7\u00e3o deve ser feita atrav\u00e9s de um token \u00fanico disponibilizado ao cliente. Sempre que houve consumo da API REST o token deve ser enviado no header da requisi\u00e7\u00e3o conforme o seguinte exemplo: TOKEN = TOKEN_AUCTUSAI header = {'Content-Type': 'application/json', 'authorization': 'Bearer TOKEN'}","title":"Autentica\u00e7\u00e3o"},{"location":"auth/#autenticacao","text":"A autentica\u00e7\u00e3o deve ser feita atrav\u00e9s de um token \u00fanico disponibilizado ao cliente. Sempre que houve consumo da API REST o token deve ser enviado no header da requisi\u00e7\u00e3o conforme o seguinte exemplo: TOKEN = TOKEN_AUCTUSAI header = {'Content-Type': 'application/json', 'authorization': 'Bearer TOKEN'}","title":"Autentica\u00e7\u00e3o"},{"location":"dados/","text":"Dados Os dados s\u00e3o obtidos atrav\u00e9s de duas rotas disponibilizadas pela Agrotools atrav\u00e9s de outra API REST. S\u00e3o elas: Analysis List Territories Analysis A primeira parte dos dados s\u00e3o an\u00e1lises dos territ\u00f3rios expondo crit\u00e9rios de legalidade. Cada relat\u00f3rio \u00e9 identificado pelo seu c\u00f3digo \u00fanico. List Territories A segunda parte cont\u00e9m caracter\u00edsticas do territ\u00f3rio como nomes dos propriet\u00e1rios, munic\u00edpio, estado, n\u00edvel, etc. Tamb\u00e9m obtidos atrav\u00e9s do c\u00f3digo \u00fanico de cada territ\u00f3rio. Banco de dados O banco de dados contru\u00eddo cont\u00e9m ambas as partes separadas e unidas, totalizando 6 tabelas: analysis raw list territories raw full data raw full data stage Nota-se a presen\u00e7a separa\u00e7\u00e3o dos dados brutos ( raw ) e refinados ( stage ).","title":"Dados"},{"location":"dados/#dados","text":"Os dados s\u00e3o obtidos atrav\u00e9s de duas rotas disponibilizadas pela Agrotools atrav\u00e9s de outra API REST. S\u00e3o elas: Analysis List Territories","title":"Dados"},{"location":"dados/#analysis","text":"A primeira parte dos dados s\u00e3o an\u00e1lises dos territ\u00f3rios expondo crit\u00e9rios de legalidade. Cada relat\u00f3rio \u00e9 identificado pelo seu c\u00f3digo \u00fanico.","title":"Analysis"},{"location":"dados/#list-territories","text":"A segunda parte cont\u00e9m caracter\u00edsticas do territ\u00f3rio como nomes dos propriet\u00e1rios, munic\u00edpio, estado, n\u00edvel, etc. Tamb\u00e9m obtidos atrav\u00e9s do c\u00f3digo \u00fanico de cada territ\u00f3rio.","title":"List Territories"},{"location":"dados/#banco-de-dados","text":"O banco de dados contru\u00eddo cont\u00e9m ambas as partes separadas e unidas, totalizando 6 tabelas: analysis raw list territories raw full data raw full data stage Nota-se a presen\u00e7a separa\u00e7\u00e3o dos dados brutos ( raw ) e refinados ( stage ).","title":"Banco de dados"},{"location":"rotas/","text":"Rotas ( endpoints ) Caminhos web para obten\u00e7\u00e3o e persist\u00eancia dos dados. Primeiro API consulta o banco full data raw , caso n\u00e3o encontrado consulta a API Agrotools tanto para analysis quanto para list territories . Ap\u00f3s obten\u00e7\u00e3o dos dados \u00e9 feita a jun\u00e7\u00e3o das partes, persistindo no banco (caso n\u00e3o tenha erro) e retornado ao usu\u00e1rio. As mensagens de erros obtidos na Agrotools s\u00e3o enviados nos campos error_territories e error_analysis do JSON de resposta, podendo aparecer em um ou ambos. Nesse caso o dado \u00e9 retornado ao usu\u00e1rio mas n\u00e3o persistido no banco. A API n\u00e3o distingue erros via Agrotools, retornando 200 nesses casos. Retornar\u00e1 um c\u00f3digo diferente de 200 caso haja algum erro interno (500) ou de autentica\u00e7\u00e3o (403). Os itens enviados ( body ) durante a requisi\u00e7\u00e3o correspondem aos c\u00f3digos dos territ\u00f3rios que se deseja consultar. Abaixo segue um exemplo para uma das rotas via linguagem python : from requests import get url_base = \"http://DOMINIO/api/v1/full_data_stage\" header = {\"Content-Type\": \"application/json\", \"authorization\": \"Bearer TOKEN\"} data = {\"cdTarget\": [8434559999985070, 8434551183268285070]} response = get(url_base, json=data, headers=header) Cd Territory Requisi\u00e7\u00e3o para obter os c\u00f3digos dos territ\u00f3rios. GET Requisi\u00e7\u00e3o Method URL GET /api/v1/cd_territory Header Contents Content-Type application/json authorization Bearer TOKEN Resposta Status Response Body 200 {\"cd_territory\" : [ {...}, ..., {...} ]} { \"cd_territory\": [ {'cd_territory': 8434551183268285070}, {'cd_territory': 8434551183268285070}, {'cd_territory': 596833845656168742} ] } Detalhes Retorna todos os c\u00f3digos presentes no banco de dados da aplica\u00e7\u00e3o. POST Requisi\u00e7\u00e3o Method URL POST /api/v1/cd_territory Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434551183268285070 ] Resposta Status Response Body 200 {\"cd_territory\" : [ {...}, ..., {...} ]} { \"cd_territory\": [ {'cd_territory': 8434551183268285070} ] } Status Response Body 409 {\"message\" : 'Um ou mais c\u00f3digos j\u00e1 existem.'} Detalhes Essa rota adiciona o c\u00f3digo enviado ao banco de dados. N\u00e3o permite c\u00f3digos duplicados. O erro 409 indica que algu\u00e9m est\u00e1 tentando inserir um ou mais c\u00f3digos j\u00e1 existentes no banco de dados. Full Data Stage Exemplo de requisi\u00e7\u00e3o para obter os dados refinados completos. Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando \u00faltimos registros sem for\u00e7ar atualiza\u00e7\u00e3o. GET Requisi\u00e7\u00e3o Method URL GET /api/v1/full_data_stage Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434559999985070, 8434551183268285070 ] Resposta Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": null, \"documento\": 0, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": null, \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Territ\u00f3rio n\u00e3o encontrado\", \"error_analysis\": \"HOUVE UM PROBLEMA AO PEGAR OS HOLDERS PARA ANALISE\", \"houve_mudanca\": null, }, {...}, {...}, ..., { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-03-14 15:10:40\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] } Detalhes Os campos entre cd_territory e area_fazenda_calculada s\u00e3o referentes aos dados list territories . J\u00e1 dataConsulta a soma_area_prodes_ha e houve_mudanca v\u00eam de analysis . Os campos \"error_territories\" e \"error_analysis\" s\u00e3o vinculados a cada parte dos dados. Existem alguns servi\u00e7os de processamento de dados ( stage ) atuando nessa rota quando o c\u00f3digo n\u00e3o existe no banco: organiza\u00e7\u00e3o dos dados brutos de list territories organiza\u00e7\u00e3o dos dados brutos de analysis merge de territories e analysis A rota sempre retorna o territ\u00f3rio com o campo dataConsulta mais recente. A gera\u00e7\u00e3o do campo houve_mudanca \u00e9 a compara\u00e7\u00e3o dos crit\u00e9rios de legalidade ( nmCriteria ). Caso um crit\u00e9rio n\u00e3o seja igual ao do \u00faltimo registro do m\u00eas anterior, ent\u00e3o houve_mudanca \u00e9 True . Full Data Stage - Docs City Exemplo de requisi\u00e7\u00e3o para obter os dados refinados a partir do documento (CPF ou CNPJ) e munic\u00edpio (cidade) ligado ao territ\u00f3rio. Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando os registros com dataConsulta mais recente sem for\u00e7ar atualiza\u00e7\u00e3o. POST Requisi\u00e7\u00e3o Method URL POST /api/v1/full_data_stage/document_city Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents full_data_stage [{\"documento\": 98454595953, \"municipio\": \"FELIZ NATAL nao existe\", \"dataConsulta\": \"2021-05-03\"}, {\"documento\": 79490336149, \"municipio\": \"NOVA MUTUM\", \"dataConsulta\": \"2021-05-03\"}] Resposta Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": null, \"documento\": 98454595953, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": \"FELIZ NATAL nao existe\", \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Recurso n\u00e3o encontrado\", \"error_analysis\": null, \"houve_mudanca\": null } { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"JOAO MIGUEL\", \"documento\": 79490336149, \"nome_fazenda\": \"FAZENDA GRANDE\", \"nivel\": \"N5\", \"municipio\": \"NOVA MUTUM\", \"uf\": \"MT\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-28 16:05:08\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"apto-79490336149\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": null }, ..., {...} ] } Detalhes An\u00e1loga a rota /api/v1/full_data_stage , por\u00e9m a consulta \u00e9 feita pelo documento e munic\u00edpio ao inv\u00e9s fazer a consulta via c\u00f3digo do territ\u00f3rio ( cd_territory ). Full Data Stage - Names City Exemplo de requisi\u00e7\u00e3o para obter os dados refinados a partir do nome do agente e munic\u00edpio (cidade) ligado ao territ\u00f3rio. Importante notar que em casos onde os crit\u00e9rios de an\u00e1lise s\u00e3o espaciais , ou seja, est\u00e3o ligados ao territ\u00f3rio e n\u00e3o a pessoas (CPF), o nome do agente aparece como \" TERRIT\u00d3RIO \". Nesse mesmo caso o documento se trata do c\u00f3digo do territ\u00f3rio (\" cd_territory \"). Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando os registros com dataConsulta mais recente sem for\u00e7ar atualiza\u00e7\u00e3o. POST Requisi\u00e7\u00e3o Method URL POST /api/v1/full_data_stage/document_city Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents full_data_stage [{\"nome_agente\": \"JO\u00c3O DAS NEVES\", \"municipio\": \"FELIZ NATAL\", \"dataConsulta\": \"2021-05-03\"}, {\"nome_agente\": \"PEDRO ALEGRE\", \"municipio\": \"NOVA MUTUM\", \"dataConsulta\": \"2021-05-03\"}] Resposta Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": \"JO\u00c3O DAS NEVES\", \"documento\": 0, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": \"FELIZ NATAL\", \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Recurso n\u00e3o encontrado\", \"error_analysis\": null, \"houve_mudanca\": null } { \"cd_territory\": 0, \"nome_agente\": \"PEDRO ALEGRE\", \"documento\": 0, \"nome_fazenda\": \"FAZENDA GRANDE\", \"nivel\": \"N5\", \"municipio\": \"NOVA MUTUM\", \"uf\": \"MT\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-05-03 16:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"apto-79490336149\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": null }, ..., {...} ] } Detalhes An\u00e1loga a rota /api/v1/full_data_stage , por\u00e9m a consulta \u00e9 feita pelo nome do agente e munic\u00edpio ao inv\u00e9s fazer a consulta via c\u00f3digo do territ\u00f3rio ( cd_territory ). Full Data Stage - Update Exemplo de requisi\u00e7\u00e3o para obter os dados refinados completos atualizados. For\u00e7a atualiza\u00e7\u00e3o no banco de dados Agrotools e persiste na aplica\u00e7\u00e3o. GET Requisi\u00e7\u00e3o Method URL GET /api/v1/full_data_stage/update Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434551183268285070 ] Resposta Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-16 17:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] } Detalhes An\u00e1loga a rota /api/v1/full_data_stage , a diferen\u00e7a consiste em atualizar os dados consultando-os diratamente na Agrootols. Full Data Stage - Update All Requisi\u00e7\u00e3o para atualizar todos os c\u00f3digos presentes na base cd territory . For\u00e7a atualiza\u00e7\u00e3o no banco de dados Agrotools e persiste na aplica\u00e7\u00e3o. GET Requisi\u00e7\u00e3o Method URL GET /api/v1/full_data_stage/update/all Header Contents Content-Type application/json authorization Bearer TOKEN Resposta Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-16 17:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] } Detalhes An\u00e1loga a rota /api/v1/full_data_stage/update , contudo os c\u00f3digos de territ\u00f3rios a serem atualizados s\u00e3o todos da base cd territory , consumida pela rota api/v1/cd_territory .","title":"Rotas"},{"location":"rotas/#rotas-endpoints","text":"Caminhos web para obten\u00e7\u00e3o e persist\u00eancia dos dados. Primeiro API consulta o banco full data raw , caso n\u00e3o encontrado consulta a API Agrotools tanto para analysis quanto para list territories . Ap\u00f3s obten\u00e7\u00e3o dos dados \u00e9 feita a jun\u00e7\u00e3o das partes, persistindo no banco (caso n\u00e3o tenha erro) e retornado ao usu\u00e1rio. As mensagens de erros obtidos na Agrotools s\u00e3o enviados nos campos error_territories e error_analysis do JSON de resposta, podendo aparecer em um ou ambos. Nesse caso o dado \u00e9 retornado ao usu\u00e1rio mas n\u00e3o persistido no banco. A API n\u00e3o distingue erros via Agrotools, retornando 200 nesses casos. Retornar\u00e1 um c\u00f3digo diferente de 200 caso haja algum erro interno (500) ou de autentica\u00e7\u00e3o (403). Os itens enviados ( body ) durante a requisi\u00e7\u00e3o correspondem aos c\u00f3digos dos territ\u00f3rios que se deseja consultar. Abaixo segue um exemplo para uma das rotas via linguagem python : from requests import get url_base = \"http://DOMINIO/api/v1/full_data_stage\" header = {\"Content-Type\": \"application/json\", \"authorization\": \"Bearer TOKEN\"} data = {\"cdTarget\": [8434559999985070, 8434551183268285070]} response = get(url_base, json=data, headers=header)","title":"Rotas (endpoints)"},{"location":"rotas/#cd-territory","text":"Requisi\u00e7\u00e3o para obter os c\u00f3digos dos territ\u00f3rios.","title":"Cd Territory"},{"location":"rotas/#get","text":"","title":"GET"},{"location":"rotas/#requisicao","text":"Method URL GET /api/v1/cd_territory Header Contents Content-Type application/json authorization Bearer TOKEN","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta","text":"Status Response Body 200 {\"cd_territory\" : [ {...}, ..., {...} ]} { \"cd_territory\": [ {'cd_territory': 8434551183268285070}, {'cd_territory': 8434551183268285070}, {'cd_territory': 596833845656168742} ] }","title":"Resposta"},{"location":"rotas/#detalhes","text":"Retorna todos os c\u00f3digos presentes no banco de dados da aplica\u00e7\u00e3o.","title":"Detalhes"},{"location":"rotas/#post","text":"","title":"POST"},{"location":"rotas/#requisicao_1","text":"Method URL POST /api/v1/cd_territory Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434551183268285070 ]","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_1","text":"Status Response Body 200 {\"cd_territory\" : [ {...}, ..., {...} ]} { \"cd_territory\": [ {'cd_territory': 8434551183268285070} ] } Status Response Body 409 {\"message\" : 'Um ou mais c\u00f3digos j\u00e1 existem.'}","title":"Resposta"},{"location":"rotas/#detalhes_1","text":"Essa rota adiciona o c\u00f3digo enviado ao banco de dados. N\u00e3o permite c\u00f3digos duplicados. O erro 409 indica que algu\u00e9m est\u00e1 tentando inserir um ou mais c\u00f3digos j\u00e1 existentes no banco de dados.","title":"Detalhes"},{"location":"rotas/#full-data-stage","text":"Exemplo de requisi\u00e7\u00e3o para obter os dados refinados completos. Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando \u00faltimos registros sem for\u00e7ar atualiza\u00e7\u00e3o.","title":"Full Data Stage"},{"location":"rotas/#get_1","text":"","title":"GET"},{"location":"rotas/#requisicao_2","text":"Method URL GET /api/v1/full_data_stage Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434559999985070, 8434551183268285070 ]","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_2","text":"Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": null, \"documento\": 0, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": null, \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Territ\u00f3rio n\u00e3o encontrado\", \"error_analysis\": \"HOUVE UM PROBLEMA AO PEGAR OS HOLDERS PARA ANALISE\", \"houve_mudanca\": null, }, {...}, {...}, ..., { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-03-14 15:10:40\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] }","title":"Resposta"},{"location":"rotas/#detalhes_2","text":"Os campos entre cd_territory e area_fazenda_calculada s\u00e3o referentes aos dados list territories . J\u00e1 dataConsulta a soma_area_prodes_ha e houve_mudanca v\u00eam de analysis . Os campos \"error_territories\" e \"error_analysis\" s\u00e3o vinculados a cada parte dos dados. Existem alguns servi\u00e7os de processamento de dados ( stage ) atuando nessa rota quando o c\u00f3digo n\u00e3o existe no banco: organiza\u00e7\u00e3o dos dados brutos de list territories organiza\u00e7\u00e3o dos dados brutos de analysis merge de territories e analysis A rota sempre retorna o territ\u00f3rio com o campo dataConsulta mais recente. A gera\u00e7\u00e3o do campo houve_mudanca \u00e9 a compara\u00e7\u00e3o dos crit\u00e9rios de legalidade ( nmCriteria ). Caso um crit\u00e9rio n\u00e3o seja igual ao do \u00faltimo registro do m\u00eas anterior, ent\u00e3o houve_mudanca \u00e9 True .","title":"Detalhes"},{"location":"rotas/#full-data-stage-docs-city","text":"Exemplo de requisi\u00e7\u00e3o para obter os dados refinados a partir do documento (CPF ou CNPJ) e munic\u00edpio (cidade) ligado ao territ\u00f3rio. Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando os registros com dataConsulta mais recente sem for\u00e7ar atualiza\u00e7\u00e3o.","title":"Full Data Stage - Docs City"},{"location":"rotas/#post_1","text":"","title":"POST"},{"location":"rotas/#requisicao_3","text":"Method URL POST /api/v1/full_data_stage/document_city Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents full_data_stage [{\"documento\": 98454595953, \"municipio\": \"FELIZ NATAL nao existe\", \"dataConsulta\": \"2021-05-03\"}, {\"documento\": 79490336149, \"municipio\": \"NOVA MUTUM\", \"dataConsulta\": \"2021-05-03\"}]","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_3","text":"Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": null, \"documento\": 98454595953, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": \"FELIZ NATAL nao existe\", \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Recurso n\u00e3o encontrado\", \"error_analysis\": null, \"houve_mudanca\": null } { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"JOAO MIGUEL\", \"documento\": 79490336149, \"nome_fazenda\": \"FAZENDA GRANDE\", \"nivel\": \"N5\", \"municipio\": \"NOVA MUTUM\", \"uf\": \"MT\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-28 16:05:08\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"apto-79490336149\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": null }, ..., {...} ] }","title":"Resposta"},{"location":"rotas/#detalhes_3","text":"An\u00e1loga a rota /api/v1/full_data_stage , por\u00e9m a consulta \u00e9 feita pelo documento e munic\u00edpio ao inv\u00e9s fazer a consulta via c\u00f3digo do territ\u00f3rio ( cd_territory ).","title":"Detalhes"},{"location":"rotas/#full-data-stage-names-city","text":"Exemplo de requisi\u00e7\u00e3o para obter os dados refinados a partir do nome do agente e munic\u00edpio (cidade) ligado ao territ\u00f3rio. Importante notar que em casos onde os crit\u00e9rios de an\u00e1lise s\u00e3o espaciais , ou seja, est\u00e3o ligados ao territ\u00f3rio e n\u00e3o a pessoas (CPF), o nome do agente aparece como \" TERRIT\u00d3RIO \". Nesse mesmo caso o documento se trata do c\u00f3digo do territ\u00f3rio (\" cd_territory \"). Essa rota consulta o banco de dados da aplica\u00e7\u00e3o retornando os registros com dataConsulta mais recente sem for\u00e7ar atualiza\u00e7\u00e3o.","title":"Full Data Stage - Names City"},{"location":"rotas/#post_2","text":"","title":"POST"},{"location":"rotas/#requisicao_4","text":"Method URL POST /api/v1/full_data_stage/document_city Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents full_data_stage [{\"nome_agente\": \"JO\u00c3O DAS NEVES\", \"municipio\": \"FELIZ NATAL\", \"dataConsulta\": \"2021-05-03\"}, {\"nome_agente\": \"PEDRO ALEGRE\", \"municipio\": \"NOVA MUTUM\", \"dataConsulta\": \"2021-05-03\"}]","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_4","text":"Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 0, \"nome_agente\": \"JO\u00c3O DAS NEVES\", \"documento\": 0, \"nome_fazenda\": null, \"nivel\": null, \"municipio\": \"FELIZ NATAL\", \"uf\": null, \"exploracao_cadastrada_terramatrix\": null, \"area_fazenda_calculada\": null, \"dataConsulta\": null, \"nmCriteria\": null, \"vlResult\": null, \"soma_area_embargos_ha\": null, \"soma_area_prodes_ha\": null, \"error_territories\": \"Recurso n\u00e3o encontrado\", \"error_analysis\": null, \"houve_mudanca\": null } { \"cd_territory\": 0, \"nome_agente\": \"PEDRO ALEGRE\", \"documento\": 0, \"nome_fazenda\": \"FAZENDA GRANDE\", \"nivel\": \"N5\", \"municipio\": \"NOVA MUTUM\", \"uf\": \"MT\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-05-03 16:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"apto-79490336149\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": null }, ..., {...} ] }","title":"Resposta"},{"location":"rotas/#detalhes_4","text":"An\u00e1loga a rota /api/v1/full_data_stage , por\u00e9m a consulta \u00e9 feita pelo nome do agente e munic\u00edpio ao inv\u00e9s fazer a consulta via c\u00f3digo do territ\u00f3rio ( cd_territory ).","title":"Detalhes"},{"location":"rotas/#full-data-stage-update","text":"Exemplo de requisi\u00e7\u00e3o para obter os dados refinados completos atualizados. For\u00e7a atualiza\u00e7\u00e3o no banco de dados Agrotools e persiste na aplica\u00e7\u00e3o.","title":"Full Data Stage - Update"},{"location":"rotas/#get_2","text":"","title":"GET"},{"location":"rotas/#requisicao_5","text":"Method URL GET /api/v1/full_data_stage/update Header Contents Content-Type application/json authorization Bearer TOKEN Request body Contents cdTarget [ 8434551183268285070 ]","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_5","text":"Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-16 17:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] }","title":"Resposta"},{"location":"rotas/#detalhes_5","text":"An\u00e1loga a rota /api/v1/full_data_stage , a diferen\u00e7a consiste em atualizar os dados consultando-os diratamente na Agrootols.","title":"Detalhes"},{"location":"rotas/#full-data-stage-update-all","text":"Requisi\u00e7\u00e3o para atualizar todos os c\u00f3digos presentes na base cd territory . For\u00e7a atualiza\u00e7\u00e3o no banco de dados Agrotools e persiste na aplica\u00e7\u00e3o.","title":"Full Data Stage - Update All"},{"location":"rotas/#get_3","text":"","title":"GET"},{"location":"rotas/#requisicao_6","text":"Method URL GET /api/v1/full_data_stage/update/all Header Contents Content-Type application/json authorization Bearer TOKEN","title":"Requisi\u00e7\u00e3o"},{"location":"rotas/#resposta_6","text":"Status Response Body 200 {\"full_data_stage\" : [ {...}, ..., {...} ]} { \"full_data_stage\": [ { \"cd_territory\": 8434551183268285070, \"nome_agente\": \"AGROPECUARIA LTDA\", \"documento\": 12347804006789, \"nome_fazenda\": \"FAZENDA BONITA\", \"nivel\": \"N5\", \"municipio\": \"CAMPINAS\", \"uf\": \"SP\", \"exploracao_cadastrada_terramatrix\": \"AGRICOLA\", \"area_fazenda_calculada\": \"406.2481'\", \"dataConsulta\": \"2021-04-16 17:00:00\", \"nmCriteria\": \"Embargos IBAMA - Lista\", \"vlResult\": \"Apto\", \"soma_area_embargos_ha\": 0.0, \"soma_area_prodes_ha\": 0.0, \"error_territories\": null, \"error_analysis\": null, \"houve_mudanca\": false } ] }","title":"Resposta"},{"location":"rotas/#detalhes_6","text":"An\u00e1loga a rota /api/v1/full_data_stage/update , contudo os c\u00f3digos de territ\u00f3rios a serem atualizados s\u00e3o todos da base cd territory , consumida pela rota api/v1/cd_territory .","title":"Detalhes"},{"location":"servicos/","text":"Servi\u00e7os Aqui ser\u00e1 descrito os servi\u00e7os mais complexos que comp\u00f5e a aplica\u00e7\u00e3o. Conector analysis - list territories Servi\u00e7o respons\u00e1vel por unir as duas partes de dados. \u00c9 executado quando o c\u00f3digo do territ\u00f3rio n\u00e3o \u00e9 encontrado no banco de dados. Ent\u00e3o \u00e9 feita a consulta no Client Agrotools e os dados s\u00e3o unidos. Abaixo \u00e9 poss\u00edvel visualizar o pseudo-c\u00f3digo controller/conect_analy_terrir.py para o m\u00e9todo ConnectAnalyTerritCtl().run() . Consulta DB Analysis se n\u00e3o existir consulta Client Agrotools se n\u00e3o houve erro Salva em DB Analysis sen\u00e3o retorna consulta Grava Aux1 Consulta DB Territories se n\u00e3o existir consulta Client Agrotools se n\u00e3o houve erro salva em DB Analysis sen\u00e3o retorna consulta Grava Aux2 Se houve erro: Merge erros Append Erro Sen\u00e3o: Merge com Aux1 & Aux2 $ colsErro Append JSONOutput Return JSONOutput, 200 Full data raw Servi\u00e7o que consome o conect_analy_terrir caso n\u00e3o encontre o c\u00f3digo do territ\u00f3rio no BD Full Data Raw. Abaixo \u00e9 poss\u00edvel visualizar o pseudo-c\u00f3digo. Enquanto existir c\u00f3digos n\u00e3o consultados: Consulta DB FullDataRaw se n\u00e3o existir consulta Outra BDs e Client Agrotools se n\u00e3o houve erro Salva em DB FullDataRaw Append consulta Return JSONOutput, 200","title":"Servi\u00e7os"},{"location":"servicos/#servicos","text":"Aqui ser\u00e1 descrito os servi\u00e7os mais complexos que comp\u00f5e a aplica\u00e7\u00e3o.","title":"Servi\u00e7os"},{"location":"servicos/#conector-analysis-list-territories","text":"Servi\u00e7o respons\u00e1vel por unir as duas partes de dados. \u00c9 executado quando o c\u00f3digo do territ\u00f3rio n\u00e3o \u00e9 encontrado no banco de dados. Ent\u00e3o \u00e9 feita a consulta no Client Agrotools e os dados s\u00e3o unidos. Abaixo \u00e9 poss\u00edvel visualizar o pseudo-c\u00f3digo controller/conect_analy_terrir.py para o m\u00e9todo ConnectAnalyTerritCtl().run() . Consulta DB Analysis se n\u00e3o existir consulta Client Agrotools se n\u00e3o houve erro Salva em DB Analysis sen\u00e3o retorna consulta Grava Aux1 Consulta DB Territories se n\u00e3o existir consulta Client Agrotools se n\u00e3o houve erro salva em DB Analysis sen\u00e3o retorna consulta Grava Aux2 Se houve erro: Merge erros Append Erro Sen\u00e3o: Merge com Aux1 & Aux2 $ colsErro Append JSONOutput Return JSONOutput, 200","title":"Conector analysis - list territories"},{"location":"servicos/#full-data-raw","text":"Servi\u00e7o que consome o conect_analy_terrir caso n\u00e3o encontre o c\u00f3digo do territ\u00f3rio no BD Full Data Raw. Abaixo \u00e9 poss\u00edvel visualizar o pseudo-c\u00f3digo. Enquanto existir c\u00f3digos n\u00e3o consultados: Consulta DB FullDataRaw se n\u00e3o existir consulta Outra BDs e Client Agrotools se n\u00e3o houve erro Salva em DB FullDataRaw Append consulta Return JSONOutput, 200","title":"Full data raw"},{"location":"contribuir/dev/","text":"Desenvolvimento Vers\u00e3o 0.1.0 da Agrotools API REST . Para mais informa\u00e7\u00f5es contate-nos .","title":"Desenvolvimento"},{"location":"contribuir/dev/#desenvolvimento","text":"Vers\u00e3o 0.1.0 da Agrotools API REST . Para mais informa\u00e7\u00f5es contate-nos .","title":"Desenvolvimento"},{"location":"contribuir/traducao/","text":"Tradu\u00e7\u00f5es Referente a tradu\u00e7\u00f5es.","title":"Tradu\u00e7\u00f5es"},{"location":"contribuir/traducao/#traducoes","text":"Referente a tradu\u00e7\u00f5es.","title":"Tradu\u00e7\u00f5es"}]}